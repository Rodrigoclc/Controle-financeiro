<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Renda</title>
    <link rel="stylesheet" href="estilo.css">
</head>
<body>
    <header>
        <a href="modelo.html"><img class="voltar" src="imagens/voltar.png" alt="voltar"></a>
        <h1>Adicionar Renda</h1>
    </header>
    <input aria-label="valor da renda" type="number" name="AdicionarRenda" id="inputAdicionarRenda">
    <br>
    <select aria-label="lista de renda" name="categoria" id="categoria">
        <option value="Mercado">Mercado</option>
        <option value="Restaurante">Restaurante</option>
        <option value="Agua">Água</option>        
    </select>
    <br>
    <input aria-label="descricao" type="text" name="descricao" id="descricao">
    <br>
    
    <img class="imgconfirmar" src="imagens/foto-confirmar.png" alt="confirmar">
    
    <script>
        var inputAdicionarRenda = document.getElementById('inputAdicionarRenda')
        var confirmarAddRenda = document.querySelector('.imgconfirmar')
        var descricao = document.querySelector('#descricao')
        var categoria = document.querySelector('#categoria')
        var ultimoProjetoSelecionado = Number(localStorage.getItem('ultimoProjeto'))

        var projetosLocalStorage = JSON.parse(localStorage.getItem('projetos'))

        confirmarAddRenda.onclick = function() {

            if (inputAdicionarRenda.value.length == 0 || inputAdicionarRenda.value <= 0) {
                alert('[ERRO] Digite um valor válido')        
            } else {

                for (i in projetosLocalStorage) {
                    //console.log(i)
                    var a = projetosLocalStorage[i]
                    //console.log(a)
                    if(a.id == ultimoProjetoSelecionado) {
                        var categoriaSelecionada = categoria.value
                        var objetoRenda = (a.renda)
                        var chave = Number(Object.keys(objetoRenda).length)                       
                        var addRenda = a                        
                        //addRenda['renda'] = {} 
                        addRenda['renda'][++chave] = {}
                        addRenda['renda'][chave]['valorRenda'] = Number(inputAdicionarRenda.value)
                        addRenda['renda'][chave]['categoria'] = categoriaSelecionada
                        addRenda['renda'][chave]['descricao'] = descricao.value
                        localStorage.setItem('projetos', JSON.stringify(projetosLocalStorage))
                        console.log(projetosLocalStorage)
                    }
                }               
            }
            inputAdicionarRenda.value = ''  
            inputAdicionarRenda.focus()
        }        
    </script>
    
</body>
</html>